<!doctype html>
<html lang="en">

	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

		<!-- Bootstrap CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
			integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

		<style>
			.material-icons {
				vertical-align: middle !important;
				padding-bottom: 3px;
			}
		</style>

		<title></title>
	</head>

	<body>
		<div class="container" style="min-width: 600px;">
			<h2>Iron Man Players</h2>

			<form id="player_form" method="GET" class="mb-3">
				<div class="mb-1">
					<input type="text" class="form-control" name="p1" placeholder="Player 1">
				</div>
				<div class="mb-1">
					<input type="text" class="form-control" name="p2" placeholder="Player 2">
				</div>
				<div class="mb-1">
					<input type="text" class="form-control" name="p3" placeholder="Player 3">
				</div>
				<div class="mb-1">
					<input type="text" class="form-control" name="p4" placeholder="Player 4">
				</div>
				<div class="mb-3">
					<input type="text" class="form-control" name="p5" placeholder="Player 5">
				</div>
				<div class="row">
					<div class="col">
						<button type="submit" class="btn btn-primary" style="float: right;">Submit</button>
					</div>
				</div>
			</form>

			<main style="display: none;">
				<nav>
					<div class="nav nav-tabs" id="nav-tab" role="tablist">
						<button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home"
							type="button" role="tab" aria-controls="nav-home" aria-selected="true">Summary</button>
						<button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile"
							type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Bosses</button>
						<button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact"
							type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Other</button>
					</div>
				</nav>
				<div class="tab-content mb-3" id="nav-tabContent">
					<!-- summary table -->
					<div class="tab-pane table-responsive fade show active" id="nav-home" role="tabpanel"
						aria-labelledby="nav-home-tab">
						<table id="summary_table" class="table table-borderless table-sm align-middle">
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
	
					<!-- boss table -->
					<div class="tab-pane table-responsive fade" id="nav-profile" role="tabpanel"
						aria-labelledby="nav-profile-tab">
						<table id="boss_table" class="table table-borderless table-sm align-middle">
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
	
					<!-- other table -->
					<div class="tab-pane table-responsive fade" id="nav-contact" role="tabpanel"
						aria-labelledby="nav-contact-tab">
						<table id="other_table" class="table table-borderless table-sm align-middle">
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</main>
		</div>

		<script src="https://code.jquery.com/jquery-3.6.0.min.js"
			integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
			crossorigin="anonymous"></script>
		<script>
			// Custom code here
			$(async () => {
				const skillHeaders = [
					"Overall",
					{ name: "Attack", image: "/images/skill-magic.svg" },
					{ name: "Defence", image: "/images/skill-defence.svg" },
					{ name: "Strength", image: "/images/skill-strength.svg" },
					{ name: "Hitpoints", image: "/images/skill-constitution.svg" },
					{ name: "Ranged", image: "/images/skill-ranged.svg" },
					{ name: "Prayer", image: "/images/skill-prayer.svg" },
					{ name: "Magic", image: "/images/skill-magic.svg" },
					{ name: "Cooking", image: "/images/skill-cooking.svg" },
					{ name: "Woodcutting", image: "/images/skill-woodcutting.svg" },
					{ name: "Fletching", image: "/images/skill-fletching.svg" },
					{ name: "Fishing", image: "/images/skill-fishing.svg" },
					{ name: "Firemaking", image: "/images/skill-firemaking.svg" },
					{ name: "Crafting", image: "/images/skill-crafting.svg" },
					{ name: "Smithing", image: "/images/skill-smithing.svg" },
					{ name: "Mining", image: "/images/skill-mining.svg" },
					{ name: "Herblore", image: "/images/skill-herblore.svg" },
					{ name: "Agility", image: "/images/skill-agility.svg" },
					{ name: "Thieving", image: "/images/skill-magic.svg" },
					{ name: "Slayer", image: "/images/skill-thieving.svg" },
					{ name: "Farming", image: "/images/skill-farming.svg" },
					{ name: "Runecrafting", image: "/images/skill-runecrafting.svg" },
					{ name: "Hunter", image: "/images/skill-hunter.svg" },
					{ name: "Construction", image: "/images/skill-construction.svg" }
				];
				const otherHeaders = [
					"League Points",
					"Bounty Hunter - Hunter",
					"Bounty Hunter - Rogue",
					"Clue Scrolls (all)",
					"Clue Scrolls (beginner)",
					"Clue Scrolls (easy)",
					"Clue Scrolls (medium)",
					"Clue Scrolls (hard)",
					"Clue Scrolls (elite)",
					"Clue Scrolls (master)",
					"LMS - Rank",
					"Soul Wars Zeal"
				];
				const bossHeaders = [
					"Abyssal Sire",
					"Alchemical Hydra",
					"Barrows Chests",
					"Bryophyta",
					"Callisto",
					"Cerberus",
					"Chambers of Xeric",
					"Chambers of Xeric: Challenge Mode",
					"Chaos Elemental",
					"Chaos Fanatic",
					"Commander Zilyana",
					"Corporeal Beast",
					"Crazy Archaeologist",
					"Dagannoth Prime",
					"Dagannoth Rex",
					"Dagannoth Supreme",
					"Deranged Archaeologist",
					"General Graardor",
					"Giant Mole",
					"Grotesque Guardians",
					"Hespori",
					"Kalphite Queen",
					"King Black Dragon",
					"Kraken",
					"Kree'Arra",
					"K'ril Tsutsaroth",
					"Mimic",
					"Nightmare",
					"Phosani's Nightmare",
					"Obor",
					"Sarachnis",
					"Scorpia",
					"Skotizo",
					"Tempoross",
					"The Gauntlet",
					"The Corrupted Gauntlet",
					"Theatre of Blood",
					"Theatre of Blood: Hard Mode",
					"Thermonuclear Smoke Devil",
					"TzKal-Zuk",
					"TzTok-Jad",
					"Venenatis",
					"Vet'ion",
					"Vorkath",
					"Wintertodt",
					"Zalcano",
					"Zulrah"
				];
				const requestHeaders = []
					.concat(skillHeaders)
					.concat(otherHeaders)
					.concat(bossHeaders);

				const params = new URLSearchParams(window.location.search);

				const players = [
					params.get('p1'),
					params.get('p2'),
					params.get('p3'),
					params.get('p4'),
					params.get('p5')
				].filter(val => val != null && val != '');

				// pull player data
				const playerSummaries = [];
				for (let i = 0; i < players.length; i++) {
					const name = players[i];
					const id = `p${i + 1}`;
					const summary = {
						id,
						name
					};
					playerSummaries[i] = summary;

					$(`input[name="${id}"]`).val(name);

					try {
						const data = await $.get({ url: `player/${name}` });
						data.split('\n').forEach((line, idx) => {
							const parts = line.split(',');
							let value = parts.length == 2 ? parts[1] : `${parts[1]}<br><span class="text-muted">(${parts[2]})</span>`;
							if (value == -1) {
								value = '';
							}
							let key = typeof requestHeaders[idx] === 'object' ? requestHeaders[idx].name : requestHeaders[idx];
							summary[key] = value;
						});
						$('main').show();
						summary.found = true;
					} catch (e) {
						console.error(e);
						summary.found = false;
					}
				};

				// set up table
				const summaryTable = $('#summary_table');
				const bossTable = $('#boss_table');
				const otherTable = $('#other_table');
				playerSummaries.forEach(summary => {
					const check = summary.found ? '<span class="material-icons text-success">done</span>' : '<span class="material-icons text-danger">close</span>';
					const colHeader = `<th>${summary.name}${check}</th>`;
					summaryTable.find('thead tr').append(colHeader);
					bossTable.find('thead tr').append(colHeader);
					otherTable.find('thead tr').append(colHeader);
				})

				// build table
				const addRow = (table, header) => {
					let header_text = '';
					let header_image = '';
					
					if (typeof header === 'object') {
						header_text = header.name;
						header_image = header.image;
					} else {
						header_text = header;
					}

					let html_image = '';
					if (header_image) {
						html_image = `<img src="${header_image}" height="25" width="25"/> `;
					}
					const row = $(`<tr><th>${html_image}${header_text}</th></tr>`);

					playerSummaries.forEach(summary => {
						const v = summary[header_text] == undefined ? '-' : summary[header_text];
						row.append(`<td>${v}</td>`)
					});

					table.find('tbody').append(row);
				}

				skillHeaders.forEach((header, i) => addRow(summaryTable, header));
				bossHeaders.forEach((header, i) => addRow(bossTable, header));
				otherHeaders.forEach((header, i) => addRow(otherTable, header));
			});
		</script>

</html>